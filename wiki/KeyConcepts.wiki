#summary Key Biodiverse concepts

<wiki:toc max_depth="4" />

= Overview =

This serves as the main interface to the help system.  Eventually it will consist of a set of links to other pages.  It is very much a work in progress at the moment.

The key point to keep in mind when using Biodiverse is that it has been developed first for spatial analyses. This includes the Moving Window, Clustering and Randomisations. All of the code has been written under this framework. Any other analysis that can be conducted is in some senses incidental. This does not mean it is invalid, just that it needs to be cast in a spatial framework to run.

= Data Structures =

See DataStructures.

= Analyses =

See AnalysisTypes.

= Spatial conditions =

See the SpatialConditions page.

= Colour schemes =

== Hue and saturation modes ==

Numerically continuous analysis results can be displayed using either Hue or Saturation modes.  

The hue mode uses colours from light blue through green and yellow to red.  It is the default for spatial results.  

The saturation mode assigns colours as different levels of saturation for a single colour, the default being red.  (This is the scheme used in the view labels tab).  You can select an alternate colour using the colour button to the right of the chooser.  Note that greyscale is currently not supported (at version 0.12), and the system only uses the hue setting, ignoring any saturation and value settings.  See issue #32.

If you are unsure of how visible your results will be to the colour blind then take a screen shot and put it through the Daltonizer at http://www.vischeck.com/daltonize/ .  Saturation mode should be better than hue in these cases.


== Contrasting colour scheme ==

Cluster analyses can be displayed as aggregates of nodes using the contrasting colour scheme.  

The contrasting colour scheme is restricted to a maximum of 13 colours, with a different colour scheme used for 9 or fewer. The schemes are derived from http://www.colorbrewer.org, but with the addition of a mid-grey to the 12 colour scheme. We have experimented with more colours, but found them difficult to distinguish (which is pretty much as recommended on the ColorBrewer web site...).


= Other topics =

== View Labels columns ==

This is a short definition of the columns visible in the labels part of the View labels tab.  _The columns need to be extended to show the selected set and also any other properties set on import._

=== Variety ===

The number of groups the label occurs in. This is analogous to the range unless one is set separately on import using the _set label remap and properties_ option.

=== Samples ===

The number of times this label occurs across all groups. Groups can have many samples of the same label.  It does not include the value set by the _set label remap and properties_ option.


=== Redundancy ===

The sample redundancy for each label. This is calculated as (1 â€“ variety / samples). A value close to one represents a good overall sample of a label relative to the number of groups it occurs in (many redundant samples). A value of zero means that there is, on average, close to one sample per group the label occurs in, and it is therefore not well sampled.


== Specifying extensions ==

_Need to explain the specification of extensions and how to load them._

== Using the spatial index ==

The spatial index speeds up processing by reducing the number of comparisons that need to be made when assessing if a group is a neighbour of the processing goup.  Exactly how much of a speed up is a function of the index resolution and the spatial condition specified (larger neighbourhoods take longer as they use more index blocks and therefore the system must make more comparisons).

As an example of the speed up, an analysis of approximately 20,000 groups took ~3600 seconds for a four cell radius circular neighbourhood without the index. With the index it took 30 seconds. Similarly, an analysis with a radius of one cell also took ~3600 seconds without the index and 12 seconds with it.

The reason for the speed-up is that the system no longer needs to assess every other group in the !BaseData as a possible neighbour, and instead focusses only on those groups that occur within the indexed blocks that satisfy the spatial condition. Think of the search through the index returning a coarse first approximation to the neighbours, with a second search refining the solution to the actual set of neighbours.

Most spatial conditions one will use are likely to be simple and use the available functions.  In these cases the system can precalculate which index bocks (elements) to search.  However, if you are using complex spatial conditions then it must preprocess the data to determine which index blocks should be assessed to find neighbours.  This can take some time when usng a fine resolution index, as it must assess each corner of the index extents, and every one of each corner block's immediate neighbours, against every other possible index block.  This results in `(m^2 * 3^m * n)` comparisons, where `n` is the number of index blocks and `m` is the number of axes (dimensions) used.  This works out to `4*9n = 36n` for a data set with two group axes.  The final analysis should still be faster for most analyses, though.

The system will ignore the spatial index if the spatial conditions used specify it must be ignored, for example with the text matching conditions.  It can also be turned off if needed by using the Analyses->Index menu.


== The ABC lists ==

_Explain ABC, ABC2 and ABC3_
These lists appear in the popup windows. They might look odd at first, and are in some senses left over from the early system development when most indices depended on some function of A, B and C.

These are based on the fundamental components used for the dissimilarity metrics. *A* is the count of shared labels, *B* is the count of labels found only in the first group, *C* is the count found only in the second group. 

*ABC2* also counts how many groups each label occurs in for the set of groups specified, while *ABC3* counts the number of samples. *ABC2* is used in endemism calculations, for example, while *ABC3* is used for those needing counts, for example redundancy.

== !NoData ==

This will occur in certain analyses when no reasonable value can result, for example where there is a division by zero or where there are no valid labels in a neighbourhood, e.g. a matrix analysis was run, but there are no labels in the neighbourhood that are listed in the matrix and therefore no value can be assigned that is a function of the matrix.

It is a bad idea to use zero in these cases, as it often has a meaning of its own, for example 0 for a Jaccard dissimilarity means the two sets of neighbours are identical.  

Nodata is stored internally using Perl's special `undef` value (meaning undefined).

Groups with a value of !NoData are plotted as white.  (Black means the group was not included in the analysis, and is typically the case in a cluster analysis if a neighbourhood or definition query is specified).  

The !NoData value can be changed on export if needed, and for the raster outputs is set to -9999 by default.  A value of zero is possible but, as explained above, it not a good choice in most cases.  Typically it is best to leave the nodata value as `undef` and let the system change it if needed (which it does for the raster exports).

== Scree plot ==

The scree plot below a tree indicates how many nodes occur at each level of, for example, dissimilarity.

== Selecting tree nodes ==

Control click or shift click to view the lists under them.  

Single click to highlight on the map.  


== Negative length nodes ==

Negative length nodes (those that go backwards) often occur when using link_recalculate clustering or when switching 
from spatial to non-spatial clustering. In the latter case this is because the two most similar clusters may not be 
within the spatial neighbourhood specified, and so the similarity of the non-spatial clusters will be closer to zero 
than the final spatial clusters. In the former case, the recalculation weights each label equally (for most similarity metrics), 
so the merging of two clusters may actually reduce their joint similarity with the other clusters in the system.

== Cluster Linkages ==

Explain them here.

== Map overlays ==

Shapefiles only at the moment. They also need to be polyline or polygon. No points, but you could buffer your points by a small 
distance and plot the resulting polygons.

Overlays are available when a map is displayed, for example when viewing labels or displaying the results of a cluster or spatial analysis.

The system currently ignores any vertices that are beyond the bounds of the BaseData groups, so you cannot zoom out any further 
than the BaseData extent.

== Supported file types ==

=== Import ===

BaseData and Matrix objects can import from text files such as CSV or TXT. They currently guess the field separator by default, 
but this can be specified as an argument if guesswork is unsuccessful.

Trees can be imported from Nexus files. NeXML support is planned.

Matrices do not care if the matrix is upper right, lower left, both, or any combination of the above. 
They will store the last defined value for an element pair (reading left to right, top to bottom).

=== Export ===

Spatial and cluster objects can be exported to table formats. Supported formats include delimited text (txt & csv), html table (htm), XML and YAML.  The latter two are probably not as useful as the others.

Exports to shapefiles are not supported due to a fatal error in the library we are using, and also due to DBF field name limitations (see below).  They can, however, be recreated from the other formats after import to a GIS or by using a suitable library.

!BaseData objects that use square cells and have only two axes can be exported to raster formats.  Currently the system supports Arc/Info asciigrid and floatgrid format, as well as ER-Mapper ERS format.  Note that the first two options will produce multiple files with the index name inserted before any specified file extension (e.g. fred.asc can result in `fred_ENDC_CWE.asc` and `fred_ENDC_WE.asc`).  The ER-Mapper export produces `fred` (the data file in Band Interleaved by Line, or BIL, format) and `fred.ers` (the header file).  Note that the ERS file does not include band statistics so these need to be calculated for them to plot properly in ArcMap.  Exporting labels with more than one column can also cause issues with the flt and asc files, as the colon used to separate the columns is a protected character as far as Windows filenames are concerned (and probably other operating systems).  Use the ERS format in these cases.

Cluster objects can also be exported to the Newick and Nexus formats (Nexus actually uses the Newick format for trees).

_Note:_ The DBF format only allows field names of ten characters.  This is not long enough for many of the index field names so DBF export has been disabled.

_Note:_ If you are exporting an asymmetric array list as a symmetric structure then the system will use the array elements as the field names and insert a 1 in each of the columns where that column element is in the list for that row element. This is because it does not have any values associated with it. If it did then it would be stored as a hash, which is a series of key/value pairs where each key is unique.  Array lists are just a sequence of values and can contain repeated values.  They are used for some of the numerical label statistics and also randomisation results for the cluster trees.  

== Using the tree exported to a table ==

The tree structure as a table allows the storage of the tree's topology in an RDBMS or other structure, including other list data such as from a spatial analysis run for each node of a cluster tree.  These cannot currently be exported using the Newick format.  (It should be possible by repeating the tree for each list element with the values stored as the bootstrap values for each node, but this is potentially very messy).